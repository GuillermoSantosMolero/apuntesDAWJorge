Guillermo Santos Molero

CREATE OR REPLACE PROCEDURE ESCRUTINIO2 IS 
CURSOR C_BOLETOS IS
SELECT DISTINCT(numeroboleto) BOLETO
FROM APUESTA;

V_ACIERTOS NUMBER;
V_AUX NUMBER;
BEGIN
  FOR R_BOLETO IN C_BOLETOS LOOP
       SELECT COUNT(*) INTO V_ACIERTOS
        FROM apuesta
        WHERE NUMEROBOLETO=R_BOLETO.BOLETO
        AND CASILLA!=15
        AND (SELECT INSTR(APUESTA.APUESTA,RESULTADO) FROM QUINIELA WHERE apuesta.casilla=CASILLA)!=0;
        IF V_ACIERTOS=14 THEN
            SELECT COUNT(*) INTO V_AUX
             FROM apuesta
             WHERE NUMEROBOLETO=R_BOLETO.BOLETO
              AND CASILLA=15
             AND (SELECT INSTR(APUESTA.APUESTA,RESULTADO) FROM QUINIELA WHERE apuesta.casilla=CASILLA)!=0;
             V_ACIERTOS:=V_ACIERTOS+V_AUX;
        END IF;
        IF V_ACIERTOS>=11 THEN
        INSERT INTO PREMIADO VALUES (R_BOLETO.BOLETO,V_ACIERTOS);
    END IF;
  END LOOP;
END ESCRUTINIO2;